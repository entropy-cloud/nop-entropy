<?xml version="1.0" encoding="UTF-8" ?>
<orm ext:registerShortName="true" ext:appName="nop-ai" ext:entityPackageName="nop.ai.dao.entity"
     ext:basePackageName="nop.ai" ext:mavenGroupId="io.github.entropy-cloud" ext:mavenArtifactId="nop-ai"
     ext:allowIdAsColName="true" x:schema="/nop/schema/orm/orm.xdef" xmlns:x="/nop/schema/xdsl.xdef"
     xmlns:i18n-en="i18n-en" xmlns:ref-i18n-en="ref-i18n-en" xmlns:ext="ext" xmlns:orm-gen="orm-gen" xmlns:xpl="xpl"
     xmlns:ui="ui">

    <x:post-extends x:override="replace">
        <orm-gen:DefaultPostExtends xpl:lib="/nop/orm/xlib/orm-gen.xlib"/>
    </x:post-extends>

    <x:gen-extends x:override="replace">
        <orm-gen:DefaultGenExtends xpl:lib="/nop/orm/xlib/orm-gen.xlib"/>
    </x:gen-extends>

    <dicts>
        <dict label="消息类型" name="ai/message_type">
            <description>对话消息的角色类型</description>
            <option code="USER" description="用户输入消息" label="用户" value="002"/>
            <option code="TOOL" description="AI回复消息" label="助手" value="003"/>
        </dict>
        <dict label="项目语言" name="ai/project_language">
            <description>项目使用的编程语言类型</description>
            <option code="JAVA" description="Java语言项目" label="Java" value="001"/>
            <option code="PYTHON" description="Python语言项目" label="Python" value="002"/>
            <option code="JAVASCRIPT" description="JavaScript/TypeScript项目" label="JavaScript" value="003"/>
            <option code="GO" description="Go语言项目" label="Go" value="004"/>
            <option code="CSHARP" description="C#语言项目" label="C#" value="005"/>
            <option code="CPP" description="C++语言项目" label="C++" value="006"/>
            <option code="OTHER" description="其他编程语言" label="其他语言" value="007"/>
        </dict>
        <dict label="规则类型" name="ai/rule_type">
            <description>项目规则分类</description>
            <option code="CODING_STYLE" description="代码格式和命名规则" label="编码规范" value="001"/>
            <option code="SECURITY" description="安全检测和防护规则" label="安全规则" value="002"/>
            <option code="PERFORMANCE" description="性能优化规则" label="性能规则" value="003"/>
            <option code="ARCHITECTURE" description="系统架构约束" label="架构规则" value="004"/>
            <option code="CUSTOM" description="用户自定义规则" label="自定义规则" value="005"/>
        </dict>
        <dict label="配置类型" name="ai/config_type">
            <description>项目配置项的数据类型</description>
            <option code="TEXT" description="字符串类型配置" label="文本" value="001"/>
            <option code="NUMBER" description="数字类型配置" label="数值" value="002"/>
            <option code="BOOLEAN" description="真假值配置" label="布尔" value="003"/>
        </dict>
        <dict label="AI供应商" name="ai/model_provider">
            <description>第三方AI服务提供商</description>
            <option code="OPENAI" description="OpenAI服务" label="OpenAI" value="001"/>
            <option code="CLAUDE" description="Claude服务" label="Claude" value="002"/>
            <option code="LOCAL" description="本地部署模型" label="本地模型" value="003"/>
        </dict>
        <dict label="需求类型" name="ai/requirement_type">
            <description>需求条目的分类</description>
            <option code="OVERVIEW" description="需求概览" label="总览" value="001"/>
            <option code="MODULE" description="功能模块需求" label="模块" value="002"/>
            <option code="CASE" description="测试用例需求" label="用例" value="003"/>
        </dict>
        <dict label="状态类型" name="ai/status_type">
            <description>数据记录状态</description>
            <option code="DRAFT" description="可编辑状态" label="草稿" value="001"/>
            <option code="PRE_FINAL" description="需人工确认" label="初步定稿" value="002"/>
            <option code="FINAL" description="不可修改状态" label="最终定稿" value="003"/>
        </dict>
        <dict label="文件格式" name="ai/file_format">
            <description>知识库文档格式类型</description>
            <option code="TEXT" description="无格式文本" label="纯文本" value="001"/>
            <option code="MARKDOWN" description="Markdown格式" label="Markdown" value="002"/>
        </dict>
        <dict label="模块类型" name="ai/module_type">
            <description>DSL生成模块分类</description>
            <option code="ORM" description="数据库模型" label="ORM模块" value="001"/>
            <option code="API" description="服务接口" label="API模块" value="002"/>
            <option code="UI" description="页面定义" label="UI模块" value="003"/>
        </dict>
    </dicts>

    <entities>
        <entity className="nop.ai.dao.entity.NopAiProject" displayName="AI项目" name="nop.ai.dao.entity.NopAiProject"
                registerShortName="true" tableName="nop_ai_project">
            <columns>
                <column code="id" displayName="主键" mandatory="true" name="id" precision="36" primary="true" propId="1"
                        stdDataType="string" stdSqlType="VARCHAR" tagSet="seq" ui:show="X"/>
                <column code="language" comment="项目使用的编程语言类型：JAVA, PYTHON等" displayName="项目语言" mandatory="true"
                        name="language" precision="4" propId="2" stdDataType="string" stdSqlType="VARCHAR"
                        ext:dict="ai/project_language"/>
                <column code="name" displayName="项目名称" mandatory="true" name="name" precision="100" propId="3"
                        stdDataType="string" stdSqlType="VARCHAR"/>
                <column code="prototype_id" displayName="模板项目ID" name="prototypeId" precision="36" propId="4"
                        stdDataType="string" stdSqlType="VARCHAR"/>
                <column code="project_dir" comment="项目在文件系统中的存储路径，例如：/data/projects/order-system" displayName="项目目录"
                        name="projectDir" precision="400" propId="5" stdDataType="string" stdSqlType="VARCHAR"
                        ui:control="textarea"/>
            </columns>
            <comment>存储AI项目基本信息</comment>
            <relations>
                <to-one name="prototype" refEntityName="nop.ai.dao.entity.NopAiProject">
                    <join>
                        <on leftProp="prototypeId" rightProp="id"/>
                    </join>
                    <ref-set/>
                </to-one>
                <to-many displayName="项目规则" name="projectRules" refEntityName="nop.ai.dao.entity.NopAiProjectRule"
                         refPropName="project">
                    <join>
                        <on leftProp="id" rightProp="projectId"/>
                    </join>
                </to-many>
                <to-many displayName="配置项" name="configs" refEntityName="nop.ai.dao.entity.NopAiProjectConfig"
                         refPropName="project">
                    <join>
                        <on leftProp="id" rightProp="projectId"/>
                    </join>
                </to-many>
                <to-many displayName="需求列表" name="requirements" refEntityName="nop.ai.dao.entity.NopAiRequirement"
                         refPropName="project">
                    <join>
                        <on leftProp="id" rightProp="projectId"/>
                    </join>
                </to-many>
                <to-many displayName="生成文件" name="generatedFiles" refEntityName="nop.ai.dao.entity.NopAiGenFile"
                         refPropName="project">
                    <join>
                        <on leftProp="id" rightProp="projectId"/>
                    </join>
                </to-many>
            </relations>
        </entity>
        <entity className="nop.ai.dao.entity.NopAiProjectRule" displayName="项目规则"
                name="nop.ai.dao.entity.NopAiProjectRule" registerShortName="true" tableName="nop_ai_project_rule">
            <columns>
                <column code="id" displayName="主键" mandatory="true" name="id" precision="36" primary="true" propId="1"
                        stdDataType="string" stdSqlType="VARCHAR" tagSet="seq" ui:show="X"/>
                <column code="project_id" displayName="项目ID" mandatory="true" name="projectId" precision="36" propId="2"
                        stdDataType="string" stdSqlType="VARCHAR"/>
                <column code="knowledge_id" comment="关联的知识库条目，规则可能基于某个知识文档" displayName="知识库ID" name="knowledgeId"
                        precision="36" propId="3" stdDataType="string" stdSqlType="VARCHAR"/>
                <column code="rule_name" comment="规则标识名称，如：code_format_rule, naming_convention" displayName="规则名称"
                        mandatory="true" name="ruleName" precision="100" propId="4" stdDataType="string"
                        stdSqlType="VARCHAR"/>
                <column code="rule_content" comment="规则的具体内容（JSON/YAML/文本）" displayName="规则内容" mandatory="true"
                        name="ruleContent" precision="4000" propId="5" stdDataType="string" stdSqlType="VARCHAR"
                        ui:control="textarea"/>
                <column code="rule_type" comment="规则分类，如：CODING_STYLE, SECURITY, PERFORMANCE" displayName="规则类型"
                        name="ruleType" precision="50" propId="6" stdDataType="string" stdSqlType="VARCHAR"/>
                <column code="is_active" displayName="是否启用" mandatory="true" name="isActive" propId="7"
                        stdDataType="boolean" stdSqlType="BOOLEAN"/>
            </columns>
            <comment>存储项目规则配置</comment>
            <relations>
                <to-one name="project" refDisplayName="项目规则" refEntityName="nop.ai.dao.entity.NopAiProject"
                        refPropName="projectRules">
                    <join>
                        <on leftProp="projectId" rightProp="id"/>
                    </join>
                    <ref-set/>
                </to-one>
                <to-one name="knowledge" refDisplayName="关联规则" refEntityName="nop.ai.dao.entity.NopAiKnowledge"
                        refPropName="relatedRules">
                    <join>
                        <on leftProp="knowledgeId" rightProp="id"/>
                    </join>
                    <ref-set/>
                </to-one>
            </relations>
        </entity>
        <entity className="nop.ai.dao.entity.NopAiProjectConfig" displayName="项目配置"
                name="nop.ai.dao.entity.NopAiProjectConfig" registerShortName="true" tableName="nop_ai_project_config">
            <columns>
                <column code="id" displayName="主键" mandatory="true" name="id" precision="36" primary="true" propId="1"
                        stdDataType="string" stdSqlType="VARCHAR" tagSet="seq" ui:show="X"/>
                <column code="project_id" displayName="项目ID" mandatory="true" name="projectId" precision="36" propId="2"
                        stdDataType="string" stdSqlType="VARCHAR"/>
                <column code="config_name" displayName="配置名称" mandatory="true" name="configName" precision="50"
                        propId="3" stdDataType="string" stdSqlType="VARCHAR"/>
                <column code="config_value" displayName="配置值" mandatory="true" name="configValue" precision="200"
                        propId="4" stdDataType="string" stdSqlType="VARCHAR"/>
                <column code="config_type" displayName="配置类型" mandatory="true" name="configType" precision="4"
                        propId="5" stdDataType="string" stdSqlType="VARCHAR" ext:dict="ai/config_type"/>
            </columns>
            <comment>项目级配置项管理</comment>
            <relations>
                <to-one name="project" refDisplayName="配置项" refEntityName="nop.ai.dao.entity.NopAiProject"
                        refPropName="configs">
                    <join>
                        <on leftProp="projectId" rightProp="id"/>
                    </join>
                    <ref-set/>
                </to-one>
            </relations>
        </entity>
        <entity className="nop.ai.dao.entity.NopAiModel" displayName="AI模型" name="nop.ai.dao.entity.NopAiModel"
                registerShortName="true" tableName="nop_ai_model">
            <columns>
                <column code="id" displayName="主键" mandatory="true" name="id" precision="36" primary="true" propId="1"
                        stdDataType="string" stdSqlType="VARCHAR" tagSet="seq" ui:show="X"/>
                <column code="provider" displayName="供应商" mandatory="true" name="provider" precision="4" propId="2"
                        stdDataType="string" stdSqlType="VARCHAR" ext:dict="ai/model_provider"/>
                <column code="model_name" displayName="模型名称" mandatory="true" name="modelName" precision="50" propId="3"
                        stdDataType="string" stdSqlType="VARCHAR"/>
                <column code="base_url" displayName="API地址" name="baseUrl" precision="200" propId="4"
                        stdDataType="string" stdSqlType="VARCHAR"/>
                <column code="api_key" displayName="API密钥" name="apiKey" precision="100" propId="5" stdDataType="string"
                        stdSqlType="VARCHAR"/>
            </columns>
            <comment>第三方AI模型注册信息</comment>
            <relations>
                <to-many displayName="调用记录" name="responses" refEntityName="nop.ai.dao.entity.NopAiChatResponse"
                         refPropName="model">
                    <join>
                        <on leftProp="id" rightProp="modelId"/>
                    </join>
                </to-many>
            </relations>
        </entity>
        <entity className="nop.ai.dao.entity.NopAiRequirement" displayName="需求条目"
                name="nop.ai.dao.entity.NopAiRequirement" registerShortName="true" tableName="nop_ai_requirement">
            <columns>
                <column code="id" displayName="主键" mandatory="true" name="id" precision="36" primary="true" propId="1"
                        stdDataType="string" stdSqlType="VARCHAR" tagSet="seq" ui:show="X"/>
                <column code="project_id" displayName="项目ID" mandatory="true" name="projectId" precision="36" propId="2"
                        stdDataType="string" stdSqlType="VARCHAR"/>
                <column code="req_number" displayName="需求编号" mandatory="true" name="reqNumber" precision="20" propId="3"
                        stdDataType="string" stdSqlType="VARCHAR"/>
                <column code="title" displayName="需求标题" mandatory="true" name="title" precision="200" propId="4"
                        stdDataType="string" stdSqlType="VARCHAR"/>
                <column code="content" displayName="需求内容" name="content" precision="4000" propId="5"
                        stdDataType="string" stdSqlType="VARCHAR" ui:control="textarea"/>
                <column code="version" displayName="当前版本" mandatory="true" name="version" precision="10" propId="6"
                        stdDataType="string" stdSqlType="VARCHAR"/>
                <column code="parent_id" displayName="父需求ID" name="parentId" precision="36" propId="7"
                        stdDataType="string" stdSqlType="VARCHAR"/>
                <column code="type" displayName="需求类型" mandatory="true" name="type" precision="4" propId="8"
                        stdDataType="string" stdSqlType="VARCHAR" ext:dict="ai/requirement_type"/>
                <column code="ai_summary" displayName="AI摘要" name="aiSummary" precision="1000" propId="9"
                        stdDataType="string" stdSqlType="VARCHAR" ui:control="textarea"/>
                <column code="status" displayName="状态" mandatory="true" name="status" precision="4" propId="10"
                        stdDataType="string" stdSqlType="VARCHAR" ext:dict="ai/status_type"/>
            </columns>
            <comment>结构化需求管理</comment>
            <relations>
                <to-one name="project" refDisplayName="需求列表" refEntityName="nop.ai.dao.entity.NopAiProject"
                        refPropName="requirements">
                    <join>
                        <on leftProp="projectId" rightProp="id"/>
                    </join>
                    <ref-set/>
                </to-one>
                <to-one name="parent" refDisplayName="子需求" refEntityName="nop.ai.dao.entity.NopAiRequirement"
                        refPropName="children">
                    <join>
                        <on leftProp="parentId" rightProp="id"/>
                    </join>
                    <ref-set/>
                </to-one>
                <to-many displayName="子需求" name="children" refEntityName="nop.ai.dao.entity.NopAiRequirement"
                         refPropName="parent">
                    <join>
                        <on leftProp="id" rightProp="parentId"/>
                    </join>
                </to-many>
                <to-many displayName="历史版本" name="historyRecords"
                         refEntityName="nop.ai.dao.entity.NopAiRequirementHistory" refPropName="requirement">
                    <join>
                        <on leftProp="id" rightProp="requirementId"/>
                    </join>
                </to-many>
                <to-many displayName="关联文件" name="generatedFiles" refEntityName="nop.ai.dao.entity.NopAiGenFile"
                         refPropName="requirement">
                    <join>
                        <on leftProp="id" rightProp="requirementId"/>
                    </join>
                </to-many>
                <to-many displayName="测试用例" name="testCases" refEntityName="nop.ai.dao.entity.NopAiTestCase"
                         refPropName="requirement">
                    <join>
                        <on leftProp="id" rightProp="requirementId"/>
                    </join>
                </to-many>
            </relations>
        </entity>
        <entity className="nop.ai.dao.entity.NopAiRequirementHistory" displayName="需求历史"
                name="nop.ai.dao.entity.NopAiRequirementHistory" registerShortName="true"
                tableName="nop_ai_requirement_history">
            <columns>
                <column code="id" displayName="主键" mandatory="true" name="id" precision="36" primary="true" propId="1"
                        stdDataType="string" stdSqlType="VARCHAR" tagSet="seq" ui:show="X"/>
                <column code="requirement_id" displayName="需求ID" mandatory="true" name="requirementId" precision="36"
                        propId="2" stdDataType="string" stdSqlType="VARCHAR"/>
                <column code="version" displayName="版本号" mandatory="true" name="version" precision="10" propId="3"
                        stdDataType="string" stdSqlType="VARCHAR"/>
                <column code="content" displayName="需求内容" mandatory="true" name="content" precision="4000" propId="4"
                        stdDataType="string" stdSqlType="VARCHAR" ui:control="textarea"/>
            </columns>
            <comment>需求变更版本记录</comment>
            <relations>
                <to-one name="requirement" refDisplayName="历史版本" refEntityName="nop.ai.dao.entity.NopAiRequirement"
                        refPropName="historyRecords">
                    <join>
                        <on leftProp="requirementId" rightProp="id"/>
                    </join>
                    <ref-set/>
                </to-one>
            </relations>
        </entity>
        <entity className="nop.ai.dao.entity.NopAiKnowledge" displayName="知识库" name="nop.ai.dao.entity.NopAiKnowledge"
                registerShortName="true" tableName="nop_ai_knowledge">
            <columns>
                <column code="id" displayName="主键" mandatory="true" name="id" precision="36" primary="true" propId="1"
                        stdDataType="string" stdSqlType="VARCHAR" tagSet="seq" ui:show="X"/>
                <column code="title" displayName="标题" mandatory="true" name="title" precision="200" propId="2"
                        stdDataType="string" stdSqlType="VARCHAR"/>
                <column code="content" displayName="内容" name="content" precision="4000" propId="3" stdDataType="string"
                        stdSqlType="VARCHAR" ui:control="textarea"/>
                <column code="format" displayName="格式类型" mandatory="true" name="format" precision="4" propId="4"
                        stdDataType="string" stdSqlType="VARCHAR" ext:dict="ai/file_format"/>
            </columns>
            <comment>领域知识文档存储</comment>
            <relations>
                <to-many displayName="关联规则" name="relatedRules" refEntityName="nop.ai.dao.entity.NopAiProjectRule"
                         refPropName="knowledge">
                    <join>
                        <on leftProp="id" rightProp="knowledgeId"/>
                    </join>
                </to-many>
            </relations>
        </entity>
        <entity className="nop.ai.dao.entity.NopAiPromptTemplate" displayName="提示词模板"
                name="nop.ai.dao.entity.NopAiPromptTemplate" registerShortName="true" tableName="nop_ai_prompt_template">
            <columns>
                <column code="id" displayName="主键" mandatory="true" name="id" precision="36" primary="true" propId="1"
                        stdDataType="string" stdSqlType="VARCHAR" tagSet="seq" ui:show="X"/>
                <column code="name" displayName="模板名称" mandatory="true" name="name" precision="100" propId="2"
                        stdDataType="string" stdSqlType="VARCHAR"/>
                <column code="content" displayName="模板内容" mandatory="true" name="content" precision="4000" propId="3"
                        stdDataType="string" stdSqlType="VARCHAR" ui:control="textarea"/>
                <column code="category" displayName="分类" name="category" precision="50" propId="4" stdDataType="string"
                        stdSqlType="VARCHAR"/>
                <column code="inputs" displayName="输入规范" name="inputs" precision="1000" propId="5" stdDataType="string"
                        stdSqlType="VARCHAR" ui:control="textarea"/>
                <column code="outputs" displayName="输出规范" name="outputs" precision="1000" propId="6"
                        stdDataType="string" stdSqlType="VARCHAR" ui:control="textarea"/>
            </columns>
            <comment>AI提示词模板定义</comment>
            <relations>
                <to-many displayName="历史版本" name="historyRecords"
                         refEntityName="nop.ai.dao.entity.NopAiPromptTemplateHistory" refPropName="template">
                    <join>
                        <on leftProp="id" rightProp="templateId"/>
                    </join>
                </to-many>
                <to-many displayName="测试请求" name="requests" refEntityName="nop.ai.dao.entity.NopAiChatRequest"
                         refPropName="template">
                    <join>
                        <on leftProp="id" rightProp="templateId"/>
                    </join>
                </to-many>
            </relations>
        </entity>
        <entity className="nop.ai.dao.entity.NopAiPromptTemplateHistory" displayName="模板历史"
                name="nop.ai.dao.entity.NopAiPromptTemplateHistory" registerShortName="true"
                tableName="nop_ai_prompt_template_history">
            <columns>
                <column code="id" displayName="主键" mandatory="true" name="id" precision="36" primary="true" propId="1"
                        stdDataType="string" stdSqlType="VARCHAR" tagSet="seq" ui:show="X"/>
                <column code="template_id" displayName="模板ID" mandatory="true" name="templateId" precision="36"
                        propId="2" stdDataType="string" stdSqlType="VARCHAR"/>
                <column code="version" displayName="版本号" mandatory="true" name="version" precision="10" propId="3"
                        stdDataType="string" stdSqlType="VARCHAR"/>
                <column code="content" displayName="模板内容" mandatory="true" name="content" precision="4000" propId="4"
                        stdDataType="string" stdSqlType="VARCHAR" ui:control="textarea"/>
            </columns>
            <comment>提示词模板版本记录</comment>
            <relations>
                <to-one name="template" refDisplayName="历史版本" refEntityName="nop.ai.dao.entity.NopAiPromptTemplate"
                        refPropName="historyRecords">
                    <join>
                        <on leftProp="templateId" rightProp="id"/>
                    </join>
                    <ref-set/>
                </to-one>
            </relations>
        </entity>
        <entity className="nop.ai.dao.entity.NopAiChatRequest" displayName="对话请求"
                name="nop.ai.dao.entity.NopAiChatRequest" registerShortName="true" tableName="nop_ai_chat_request">
            <columns>
                <column code="id" displayName="主键" mandatory="true" name="id" precision="36" primary="true" propId="1"
                        stdDataType="string" stdSqlType="VARCHAR" tagSet="seq" ui:show="X"/>
                <column code="template_id" displayName="模板ID" name="templateId" precision="36" propId="2"
                        stdDataType="string" stdSqlType="VARCHAR"/>
                <column code="session_id" displayName="会话ID" mandatory="true" name="sessionId" precision="36" propId="3"
                        stdDataType="string" stdSqlType="VARCHAR"/>
                <column code="system_prompt" displayName="系统提示词" name="systemPrompt" precision="65536" propId="4"
                        stdDataType="string" stdSqlType="VARCHAR" ui:control="textarea"/>
                <column code="user_prompt" displayName="用户提示词" mandatory="true" name="userPrompt" precision="65536"
                        propId="5" stdDataType="string" stdSqlType="VARCHAR" ui:control="textarea"/>
                <column code="message_type" displayName="消息类型" mandatory="true" name="messageType" precision="4"
                        propId="6" stdDataType="string" stdSqlType="VARCHAR" ext:dict="ai/message_type"/>
                <column code="request_timestamp" displayName="请求时间戳" mandatory="true" name="requestTimestamp" propId="7"
                        stdDataType="timestamp" stdSqlType="TIMESTAMP"/>
                <column code="hash" displayName="内容哈希" mandatory="true" name="hash" precision="64" propId="8"
                        stdDataType="string" stdSqlType="VARCHAR"/>
                <column code="metadata" displayName="元数据" name="metadata" precision="2000" propId="9"
                        stdDataType="string" stdSqlType="VARCHAR" ui:control="textarea"/>
            </columns>
            <comment>多模型测试请求记录</comment>
            <relations>
                <to-one name="template" refDisplayName="测试请求" refEntityName="nop.ai.dao.entity.NopAiPromptTemplate"
                        refPropName="requests">
                    <join>
                        <on leftProp="templateId" rightProp="id"/>
                    </join>
                    <ref-set/>
                </to-one>
                <to-many displayName="响应列表" name="responses" refEntityName="nop.ai.dao.entity.NopAiChatResponse"
                         refPropName="request">
                    <join>
                        <on leftProp="id" rightProp="requestId"/>
                    </join>
                </to-many>
            </relations>
        </entity>
        <entity className="nop.ai.dao.entity.NopAiChatResponse" displayName="响应结果"
                name="nop.ai.dao.entity.NopAiChatResponse" registerShortName="true" tableName="nop_ai_chat_response">
            <columns>
                <column code="id" displayName="主键" mandatory="true" name="id" precision="36" primary="true" propId="1"
                        stdDataType="string" stdSqlType="VARCHAR" tagSet="seq" ui:show="X"/>
                <column code="request_id" displayName="请求ID" mandatory="true" name="requestId" precision="36" propId="2"
                        stdDataType="string" stdSqlType="VARCHAR"/>
                <column code="session_id" displayName="会话ID" mandatory="true" name="sessionId" precision="36" propId="3"
                        stdDataType="string" stdSqlType="VARCHAR"/>
                <column code="model_id" displayName="模型ID" mandatory="true" name="modelId" precision="36" propId="4"
                        stdDataType="string" stdSqlType="VARCHAR"/>
                <column code="ai_provider" displayName="供应商" mandatory="true" name="aiProvider" precision="4" propId="5"
                        stdDataType="string" stdSqlType="VARCHAR" ext:dict="ai/model_provider"/>
                <column code="ai_model" displayName="模型名称" mandatory="true" name="aiModel" precision="50" propId="6"
                        stdDataType="string" stdSqlType="VARCHAR"/>
                <column code="response_content" displayName="响应内容" mandatory="true" name="responseContent"
                        precision="65536" propId="7" stdDataType="string" stdSqlType="VARCHAR" ui:control="textarea"/>
                <column code="response_timestamp" displayName="响应时间戳" mandatory="true" name="responseTimestamp"
                        propId="8" stdDataType="timestamp" stdSqlType="TIMESTAMP"/>
                <column code="prompt_tokens" comment="请求消息消耗的Token数量" displayName="请求Token数" name="promptTokens"
                        propId="9" stdDataType="int" stdSqlType="INTEGER"/>
                <column code="completion_tokens" comment="响应消息消耗的Token数量" displayName="响应Token数" name="completionTokens"
                        propId="10" stdDataType="int" stdSqlType="INTEGER"/>
                <column code="response_duration_ms" displayName="响应耗时(毫秒)" name="responseDurationMs" propId="11"
                        stdDataType="int" stdSqlType="INTEGER"/>
                <column code="correctness_score" displayName="正确性分" name="correctnessScore" precision="5" propId="12"
                        scale="2" stdDataType="decimal" stdSqlType="DECIMAL"/>
                <column code="performance_score" displayName="性能分" name="performanceScore" precision="5" propId="13"
                        scale="2" stdDataType="decimal" stdSqlType="DECIMAL"/>
                <column code="readability_score" displayName="可读性分" name="readabilityScore" precision="5" propId="14"
                        scale="2" stdDataType="decimal" stdSqlType="DECIMAL"/>
                <column code="compliance_score" displayName="合规性分" name="complianceScore" precision="5" propId="15"
                        scale="2" stdDataType="decimal" stdSqlType="DECIMAL"/>
            </columns>
            <comment>AI模型响应记录</comment>
            <relations>
                <to-one name="request" refDisplayName="响应列表" refEntityName="nop.ai.dao.entity.NopAiChatRequest"
                        refPropName="responses">
                    <join>
                        <on leftProp="requestId" rightProp="id"/>
                    </join>
                    <ref-set/>
                </to-one>
                <to-one name="model" refDisplayName="调用记录" refEntityName="nop.ai.dao.entity.NopAiModel"
                        refPropName="responses">
                    <join>
                        <on leftProp="modelId" rightProp="id"/>
                    </join>
                    <ref-set/>
                </to-one>
                <to-many displayName="生成产物" name="generatedFiles" refEntityName="nop.ai.dao.entity.NopAiGenFile"
                         refPropName="chatResponse">
                    <join>
                        <on leftProp="id" rightProp="chatResponseId"/>
                    </join>
                </to-many>
                <to-many displayName="生成用例" name="testCases" refEntityName="nop.ai.dao.entity.NopAiTestCase"
                         refPropName="chatResponse">
                    <join>
                        <on leftProp="id" rightProp="chatResponseId"/>
                    </join>
                </to-many>
            </relations>
        </entity>
        <entity className="nop.ai.dao.entity.NopAiGenFile" displayName="生成文件" name="nop.ai.dao.entity.NopAiGenFile"
                registerShortName="true" tableName="nop_ai_gen_file">
            <columns>
                <column code="id" displayName="主键" mandatory="true" name="id" precision="36" primary="true" propId="1"
                        stdDataType="string" stdSqlType="VARCHAR" tagSet="seq" ui:show="X"/>
                <column code="project_id" displayName="项目ID" mandatory="true" name="projectId" precision="36" propId="2"
                        stdDataType="string" stdSqlType="VARCHAR"/>
                <column code="requirement_id" displayName="需求ID" name="requirementId" precision="36" propId="3"
                        stdDataType="string" stdSqlType="VARCHAR"/>
                <column code="module_type" displayName="模块类型" mandatory="true" name="moduleType" precision="4"
                        propId="4" stdDataType="string" stdSqlType="VARCHAR" ext:dict="ai/module_type"/>
                <column code="content" comment="当前文件内容" displayName="文件内容" mandatory="true" name="content"
                        precision="65536" propId="5" stdDataType="string" stdSqlType="VARCHAR" ui:control="textarea"/>
                <column code="file_path" displayName="文件路径" mandatory="true" name="filePath" precision="200" propId="6"
                        stdDataType="string" stdSqlType="VARCHAR"/>
                <column code="chat_response_id" displayName="响应ID" name="chatResponseId" precision="36" propId="7"
                        stdDataType="string" stdSqlType="VARCHAR"/>
                <column code="status" displayName="状态" mandatory="true" name="status" precision="4" propId="8"
                        stdDataType="string" stdSqlType="VARCHAR" ext:dict="ai/status_type"/>
            </columns>
            <comment>AI生成的DSL模型文件</comment>
            <relations>
                <to-one name="project" refDisplayName="生成文件" refEntityName="nop.ai.dao.entity.NopAiProject"
                        refPropName="generatedFiles">
                    <join>
                        <on leftProp="projectId" rightProp="id"/>
                    </join>
                    <ref-set/>
                </to-one>
                <to-one name="requirement" refDisplayName="关联文件" refEntityName="nop.ai.dao.entity.NopAiRequirement"
                        refPropName="generatedFiles">
                    <join>
                        <on leftProp="requirementId" rightProp="id"/>
                    </join>
                    <ref-set/>
                </to-one>
                <to-one name="chatResponse" refDisplayName="生成产物" refEntityName="nop.ai.dao.entity.NopAiChatResponse"
                        refPropName="generatedFiles">
                    <join>
                        <on leftProp="chatResponseId" rightProp="id"/>
                    </join>
                    <ref-set/>
                </to-one>
                <to-many displayName="历史版本" name="historyRecords" refEntityName="nop.ai.dao.entity.NopAiGenFileHistory"
                         refPropName="genFile">
                    <join>
                        <on leftProp="id" rightProp="genFileId"/>
                    </join>
                </to-many>
                <to-many displayName="测试用例" name="testCases" refEntityName="nop.ai.dao.entity.NopAiTestCase"
                         refPropName="genFile">
                    <join>
                        <on leftProp="id" rightProp="genFileId"/>
                    </join>
                </to-many>
            </relations>
        </entity>
        <entity className="nop.ai.dao.entity.NopAiGenFileHistory" displayName="文件历史"
                name="nop.ai.dao.entity.NopAiGenFileHistory" registerShortName="true"
                tableName="nop_ai_gen_file_history">
            <columns>
                <column code="id" displayName="主键" mandatory="true" name="id" precision="36" primary="true" propId="1"
                        stdDataType="string" stdSqlType="VARCHAR" tagSet="seq" ui:show="X"/>
                <column code="gen_file_id" displayName="文件ID" mandatory="true" name="genFileId" precision="36"
                        propId="2" stdDataType="string" stdSqlType="VARCHAR"/>
                <column code="version" displayName="版本号" mandatory="true" name="version" precision="10" propId="3"
                        stdDataType="string" stdSqlType="VARCHAR"/>
                <column code="content" comment="当前文件内容" displayName="文件内容" mandatory="true" name="content"
                        precision="65536" propId="4" stdDataType="string" stdSqlType="VARCHAR" ui:control="textarea"/>
            </columns>
            <comment>生成文件版本记录</comment>
            <relations>
                <to-one name="genFile" refDisplayName="历史版本" refEntityName="nop.ai.dao.entity.NopAiGenFile"
                        refPropName="historyRecords">
                    <join>
                        <on leftProp="genFileId" rightProp="id"/>
                    </join>
                    <ref-set/>
                </to-one>
            </relations>
        </entity>
        <entity className="nop.ai.dao.entity.NopAiTestCase" displayName="测试用例" name="nop.ai.dao.entity.NopAiTestCase"
                registerShortName="true" tableName="nop_ai_test_case">
            <columns>
                <column code="id" displayName="主键" mandatory="true" name="id" precision="36" primary="true" propId="1"
                        stdDataType="string" stdSqlType="VARCHAR" tagSet="seq" ui:show="X"/>
                <column code="requirement_id" displayName="需求ID" mandatory="true" name="requirementId" precision="36"
                        propId="2" stdDataType="string" stdSqlType="VARCHAR"/>
                <column code="test_content" displayName="测试内容" mandatory="true" name="testContent" precision="2000"
                        propId="3" stdDataType="string" stdSqlType="VARCHAR" ui:control="textarea"/>
                <column code="test_data" displayName="测试数据" name="testData" precision="1000" propId="4"
                        stdDataType="string" stdSqlType="VARCHAR" ui:control="textarea"/>
                <column code="gen_file_id" displayName="关联文件ID" name="genFileId" precision="36" propId="5"
                        stdDataType="string" stdSqlType="VARCHAR"/>
                <column code="chat_response_id" displayName="响应ID" name="chatResponseId" precision="36" propId="6"
                        stdDataType="string" stdSqlType="VARCHAR"/>
                <column code="status" displayName="状态" mandatory="true" name="status" precision="4" propId="7"
                        stdDataType="string" stdSqlType="VARCHAR" ext:dict="ai/status_type"/>
            </columns>
            <comment>生成的测试用例</comment>
            <relations>
                <to-one name="requirement" refDisplayName="测试用例" refEntityName="nop.ai.dao.entity.NopAiRequirement"
                        refPropName="testCases">
                    <join>
                        <on leftProp="requirementId" rightProp="id"/>
                    </join>
                    <ref-set/>
                </to-one>
                <to-one name="genFile" refDisplayName="测试用例" refEntityName="nop.ai.dao.entity.NopAiGenFile"
                        refPropName="testCases">
                    <join>
                        <on leftProp="genFileId" rightProp="id"/>
                    </join>
                    <ref-set/>
                </to-one>
                <to-one name="chatResponse" refDisplayName="生成用例" refEntityName="nop.ai.dao.entity.NopAiChatResponse"
                        refPropName="testCases">
                    <join>
                        <on leftProp="chatResponseId" rightProp="id"/>
                    </join>
                    <ref-set/>
                </to-one>
                <to-many displayName="执行结果" name="testResults" refEntityName="nop.ai.dao.entity.NopAiTestResult"
                         refPropName="testCase">
                    <join>
                        <on leftProp="id" rightProp="testCaseId"/>
                    </join>
                </to-many>
            </relations>
        </entity>
        <entity className="nop.ai.dao.entity.NopAiTestResult" displayName="测试结果"
                name="nop.ai.dao.entity.NopAiTestResult" registerShortName="true" tableName="nop_ai_test_result">
            <columns>
                <column code="id" displayName="主键" mandatory="true" name="id" precision="36" primary="true" propId="1"
                        stdDataType="string" stdSqlType="VARCHAR" tagSet="seq" ui:show="X"/>
                <column code="test_case_id" displayName="测试用例ID" mandatory="true" name="testCaseId" precision="36"
                        propId="2" stdDataType="string" stdSqlType="VARCHAR"/>
                <column code="execution_time" displayName="执行时间" mandatory="true" name="executionTime" propId="3"
                        stdDataType="timestamp" stdSqlType="TIMESTAMP"/>
                <column code="success" displayName="是否成功" mandatory="true" name="success" propId="4"
                        stdDataType="boolean" stdSqlType="BOOLEAN"/>
                <column code="error_log" displayName="错误日志" name="errorLog" precision="2000" propId="5"
                        stdDataType="string" stdSqlType="VARCHAR" ui:control="textarea"/>
            </columns>
            <comment>测试用例执行结果</comment>
            <relations>
                <to-one name="testCase" refDisplayName="执行结果" refEntityName="nop.ai.dao.entity.NopAiTestCase"
                        refPropName="testResults">
                    <join>
                        <on leftProp="testCaseId" rightProp="id"/>
                    </join>
                    <ref-set/>
                </to-one>
            </relations>
        </entity>
    </entities>
</orm>