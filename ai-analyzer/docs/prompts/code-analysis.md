# 代码分析提示词设计

## 1. 文件级别解析提示词

### 1.1 类/接口结构分析
**提示词模板**：
```
请分析以下Java代码的类/接口结构：

{代码内容}

请严格按照 `config/ai-prompt-models.xdef` 中定义的 `ClassInterfaceStructureAnalysis` 模型结构提供JSON格式的响应。

**重要说明：所有Nop平台相关知识必须参考 `docs-for-ai` 目录下的文档，确保XDef定义符合规范。**
```

## 返回格式

**XDef模型定义**：参考 `config/ai-prompt-models.xdef` 中的 `ClassInterfaceStructureAnalysis` 模型

**JSON格式示例**：
```json
{
  "basicInfo": {
    "type": "类/接口/枚举/注解",
    "fullName": "完整类名",
    "package": "所属包",
    "modifiers": ["public", "protected", "private", "package"],
    "inheritance": {
      "parentClass": "父类",
      "implementedInterfaces": ["实现的接口"]
    }
  },
  "responsibilityAnalysis": {
    "coreFunction": "用一句话描述该类的主要职责",
    "designPatterns": ["识别使用的设计模式"],
    "complexity": "simple/moderate/complex"
  },
  "structureComposition": {
    "fields": [
      {
        "name": "字段名称",
        "type": "字段类型",
        "modifiers": ["访问修饰符"]
      }
    ],
    "methods": [
      {
        "name": "方法名称",
        "returnType": "返回类型",
        "parameters": ["参数列表"]
      }
    ],
    "innerClasses": [
      {
        "name": "内部类名称",
        "purpose": "内部类用途"
      }
    ]
  },
  "semanticInfo": {
    "businessDomain": "属于哪个业务领域",
    "technicalRole": "在架构中的角色",
    "keyFeatures": ["重要的功能特性"]
  }
}
```

**应用对象**：单个Java文件

### 1.2 方法级别分析
**提示词模板**：
```
请分析以下Java方法：

{方法代码}

所属类：{类名}

请提供详细分析：

1. 方法签名：
   - 返回类型：
   - 参数列表：名称、类型、用途
   - 异常声明：抛出的异常类型

2. 功能分析：
   - 核心功能：用自然语言描述方法的作用
   - 业务逻辑：涉及的业务规则和逻辑
   - 技术实现：使用的技术手段和算法

3. 复杂度评估：
   - 代码行数：
   - 控制流复杂度：简单/中等/复杂
   - 认知复杂度：易于理解/需要专业知识/非常复杂

4. 使用场景：
   - 典型调用场景：
   - 前置条件：调用前需要满足的条件
   - 后置条件：调用后的状态变化

5. 潜在问题：
   - 性能问题：可能的性能瓶颈
   - 安全问题：潜在的安全风险
   - 维护问题：可能难以维护的地方
```

## 2. 语义关系提取提示词

### 2.1 调用关系分析
**提示词模板**：
```
请分析以下代码片段中的方法调用关系：

{代码片段}

请识别：
1. 内部调用：同一类内的方法调用
2. 外部调用：对其他类方法的调用
3. 库调用：对第三方库的调用
4. 系统调用：对Java系统库的调用

对于每个调用，提供：
- 调用方法：方法名称
- 被调用方法：完整方法签名
- 调用上下文：在什么情况下调用
- 数据传递：传递的参数和返回值
```

### 2.2 依赖关系分析
**提示词模板**：
```
请分析以下Java类的依赖关系：

{类代码}

请识别：
1. 编译时依赖：通过import引入的类
2. 运行时依赖：通过反射或动态加载的类
3. 配置依赖：依赖的配置项和参数
4. 资源依赖：依赖的文件、数据库等资源

对于每个依赖，评估：
- 依赖强度：强依赖/弱依赖
- 依赖方向：单向/双向
- 耦合程度：高耦合/低耦合
```

## 3. 设计模式识别提示词

### 3.1 模式识别模板
**提示词模板**：
```
请分析以下Java代码中使用的设计模式：

{代码内容}

请识别可能的设计模式，包括：
1. 创建型模式：单例、工厂、建造者等
2. 结构型模式：适配器、装饰器、代理等
3. 行为型模式：策略、观察者、命令等

对于每个识别的模式，提供：
- 模式名称：
- 实现方式：如何在该代码中实现
- 模式意图：解决什么问题
- 适用性：是否适合当前场景
- 改进建议：可能的改进方案
```

## 4. 复杂度评估提示词

### 4.1 代码复杂度分析
**提示词模板**：
```
请评估以下Java代码的复杂度：

{代码内容}

请从以下维度评估：

1. 结构复杂度：
   - 嵌套深度：方法调用的嵌套层次
   - 分支数量：if/switch语句的数量
   - 循环复杂度：循环结构的复杂程度

2. 认知复杂度：
   - 可读性：代码是否易于理解
   - 逻辑清晰度：业务逻辑是否清晰
   - 命名规范性：变量和方法命名是否规范

3. 维护复杂度：
   - 修改难度：修改代码的难易程度
   - 测试难度：编写测试用例的难度
   - 扩展难度：添加新功能的难度

4. 综合评分：
   - 总体复杂度：1-10分
   - 重构建议：是否需要重构
   - 重构优先级：高/中/低
```

## 5. 使用模式提取提示词

### 5.1 API使用模式
**提示词模板**：
```
请分析以下API的使用模式：

{API代码}

请识别：
1. 典型使用场景：最常见的用法
2. 参数组合模式：参数的不同组合方式
3. 错误处理模式：如何处理异常和错误
4. 性能优化模式：性能相关的使用技巧

请提供具体的代码示例来说明每种模式。
```

## 6. 最佳实践识别提示词

### 6.1 代码质量评估
**提示词模板**：
```
请评估以下Java代码的质量并识别最佳实践：

{代码内容}

请关注：
1. 代码规范：是否符合Java编码规范
2. 设计原则：是否遵循SOLID原则
3. 性能优化：是否有性能优化空间
4. 安全性：是否存在安全风险
5. 可维护性：是否易于维护和扩展

请提供具体的改进建议和最佳实践示例。
```

## 提示词使用策略

### 批量处理策略
- **文件分组**：按模块或功能分组处理
- **并行处理**：多个文件同时分析
- **结果合并**：分析结果合并为完整项目视图

### 错误处理策略
- **重试机制**：分析失败时自动重试
- **部分分析**：即使部分失败也能继续
- **错误记录**：记录分析失败的原因

### 质量保证策略
- **结果验证**：验证分析结果的合理性
- **一致性检查**：检查不同分析结果的一致性
- **人工审核**：关键结果的人工审核机制

这些提示词设计旨在充分利用AI的语义理解能力，提供结构化和深度的代码分析结果，为后续的关系提取和语义增强奠定基础。