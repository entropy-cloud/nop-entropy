<?xml version="1.0" encoding="UTF-8" ?>
<orm ext:registerShortName="true" ext:appName="nop-retry" ext:entityPackageName="io.nop.retry.dao.entity"
     ext:basePackageName="io.nop.retry" ext:mavenGroupId="io.github.entropy-cloud" ext:mavenArtifactId="nop-retry"
     ext:mavenVersion="2.0.0-SNAPSHOT" ext:platformVersion="2.0.0-SNAPSHOT" ext:dialect="mysql,oracle,postgresql"
     x:schema="/nop/schema/orm/orm.xdef" xmlns:x="/nop/schema/xdsl.xdef">

    <dicts>
        <dict label="重试记录状态" name="retry/retry-record-status" valueType="int" i18n-en:label="Retry Record Status">
            <option code="PENDING" label="待调度" value="0" i18n-en:label="Pending"/>
            <option code="RETRYING" label="重试中" value="1" i18n-en:label="Retrying"/>
            <option code="COMPLETED" label="已完成" value="2" i18n-en:label="Completed"/>
            <option code="MAX_RETRIES" label="超限" value="3" i18n-en:label="Max Retries"/>
            <option code="SUSPENDED" label="已暂停" value="4" i18n-en:label="Suspended"/>
        </dict>
        <dict label="重试尝试状态" name="retry/retry-attempt-status" valueType="int" i18n-en:label="Retry Attempt Status">
            <option code="WAITING" label="等待中" value="0" i18n-en:label="Waiting"/>
            <option code="RUNNING" label="执行中" value="1" i18n-en:label="Running"/>
            <option code="SUCCESS" label="成功" value="2" i18n-en:label="Success"/>
            <option code="FAILED" label="失败" value="3" i18n-en:label="Failed"/>
            <option code="STOPPED" label="已停止" value="4" i18n-en:label="Stopped"/>
            <option code="CANCELED" label="已取消" value="5" i18n-en:label="Canceled"/>
        </dict>
        <dict label="重试任务类型" name="retry/retry-task-type" valueType="int" i18n-en:label="Retry Task Type">
            <option code="RETRY" label="业务重试" value="1" i18n-en:label="Retry"/>
            <option code="CALLBACK" label="回调任务" value="2" i18n-en:label="Callback"/>
        </dict>
        <dict label="退避策略" name="retry/backoff-strategy" valueType="int" i18n-en:label="Backoff Strategy">
            <option code="FIXED_INTERVAL" label="固定间隔" value="1" i18n-en:label="Fixed Interval"/>
            <option code="EXPONENTIAL_BACKOFF" label="指数退避" value="2" i18n-en:label="Exponential Backoff"/>
            <option code="CRON_EXPRESSION" label="Cron表达式" value="3" i18n-en:label="Cron Expression"/>
        </dict>
        <dict label="阻塞策略" name="retry/block-strategy" valueType="int" i18n-en:label="Block Strategy">
            <option code="DISCARD" label="丢弃" value="1" i18n-en:label="Discard"/>
            <option code="OVERWRITE" label="覆盖" value="2" i18n-en:label="Overwrite"/>
            <option code="PARALLEL" label="并行" value="3" i18n-en:label="Parallel"/>
        </dict>
        <dict label="回调触发类型" name="retry/callback-trigger-type" valueType="int" i18n-en:label="Callback Trigger Type">
            <option code="ON_SUCCESS" label="成功时触发" value="1" i18n-en:label="On Success"/>
            <option code="ON_FAILURE" label="失败时触发" value="2" i18n-en:label="On Failure"/>
            <option code="ALWAYS" label="总是触发" value="3" i18n-en:label="Always"/>
        </dict>
    </dicts>

    <domains>
        <!-- Standard audit domains -->
        <domain name="version" stdSqlType="INTEGER"/>
        <domain name="createTime" stdSqlType="TIMESTAMP"/>
        <domain name="createdBy" precision="50" stdSqlType="VARCHAR"/>
        <domain name="updateTime" stdSqlType="TIMESTAMP"/>
        <domain name="updatedBy" precision="50" stdSqlType="VARCHAR"/>

        <!-- Retry-specific IDs & names -->
        <domain name="namespaceId" precision="64" stdSqlType="VARCHAR"/>
        <domain name="groupId" precision="64" stdSqlType="VARCHAR"/>
        <domain name="templateId" precision="32" stdSqlType="VARCHAR"/>
        <domain name="idempotentId" precision="64" stdSqlType="VARCHAR"/>
        <domain name="bizNo" precision="64" stdSqlType="VARCHAR"/>
        <domain name="executorName" precision="512" stdSqlType="VARCHAR"/>

        <!-- Payloads and JSON -->
        <domain name="json-4000" precision="4000" stdDomain="json" stdSqlType="VARCHAR"/>

        <!-- Numeric counters -->
        <domain name="retryCount" stdSqlType="INTEGER"/>
        <domain name="maxRetryCount" stdSqlType="INTEGER"/>

        <!-- Time fields -->
        <domain name="nextTriggerTime" stdSqlType="TIMESTAMP"/>

        <!-- Additional domains for NopRetryTemplate -->
        <domain name="boolFlag" precision="1" stdDomain="boolFlag" stdSqlType="VARCHAR"/>
        <domain name="backoffStrategy" stdSqlType="INTEGER"/>
        <domain name="executionTimeoutSeconds" stdSqlType="INTEGER"/>
        <domain name="deadlineTimeoutMs" stdSqlType="BIGINT"/>
        <domain name="blockStrategy" stdSqlType="INTEGER"/>
        <domain name="callbackEnabled" precision="1" stdDomain="boolFlag" stdSqlType="VARCHAR"/>
        <domain name="callbackTriggerType" stdSqlType="INTEGER"/>
        <domain name="callbackMaxAttempts" stdSqlType="INTEGER"/>
        <domain name="callbackIntervalSeconds" stdSqlType="INTEGER"/>

        <!-- Additional domains for NopRetryRecord -->
        <domain name="taskType" stdSqlType="INTEGER"/>
        <domain name="retryRecordStatus" stdSqlType="INTEGER"/>
        <domain name="partitionIndex" stdSqlType="INTEGER"/>

        <!-- Additional domains for NopRetryAttempt -->
        <domain name="attemptNo" stdSqlType="INTEGER"/>
        <domain name="retryAttemptStatus" stdSqlType="INTEGER"/>
        <domain name="durationMs" stdSqlType="BIGINT"/>
    </domains>

    <entities>
        <entity name="io.nop.retry.dao.entity.NopRetryTemplate"
                tableName="nop_retry_template" displayName="重试模板" i18n-en:displayName="Retry Template"
                registerShortName="true" versionProp="version" createTimeProp="createTime"
                createrProp="createdBy" updateTimeProp="updateTime" updaterProp="updatedBy">
            <columns>
                <!-- Primary Key -->
                <column code="SID" name="sid" displayName="主键" i18n-en:displayName="Primary Key"
                        domain="templateId" mandatory="true" primary="true" propId="1"
                        stdDataType="string" stdSqlType="VARCHAR" tagSet="seq"/>

                <!-- Namespace and Group -->
                <column code="NAMESPACE_ID" name="namespaceId" displayName="命名空间ID" i18n-en:displayName="Namespace ID"
                        domain="namespaceId" mandatory="true" propId="2" stdDataType="string" stdSqlType="VARCHAR"/>

                <column code="GROUP_ID" name="groupId" displayName="组ID" i18n-en:displayName="Group ID"
                        domain="groupId" mandatory="true" propId="3" stdDataType="string" stdSqlType="VARCHAR"/>

                <!-- Template Info -->
                <column code="NAME" name="name" displayName="模板名称" i18n-en:displayName="Template Name"
                        precision="100" mandatory="true" propId="4" stdDataType="string" stdSqlType="VARCHAR"/>

                <column code="STATUS" name="status" displayName="状态" i18n-en:displayName="Status"
                        domain="boolFlag" propId="5" stdDataType="string" stdSqlType="VARCHAR" defaultValue="1"/>

                <!-- Retry Configuration -->
                <column code="MAX_RETRY_COUNT" name="maxRetryCount" displayName="最大重试次数" i18n-en:displayName="Max Retry Count"
                        domain="maxRetryCount" mandatory="true" propId="6" stdDataType="int" stdSqlType="INTEGER"/>

                <column code="BACKOFF_STRATEGY" name="backoffStrategy" displayName="退避策略" i18n-en:displayName="Backoff Strategy"
                        domain="backoffStrategy" propId="7" stdDataType="int" stdSqlType="INTEGER"
                        ext:dict="retry/backoff-strategy"/>

                <column code="BACKOFF_CONFIG" name="backoffConfig" displayName="退避配置" i18n-en:displayName="Backoff Config"
                        domain="json-4000" propId="8" stdDataType="string" stdDomain="json" stdSqlType="VARCHAR"/>

                <column code="EXECUTION_TIMEOUT_SECONDS" name="executionTimeoutSeconds" displayName="执行超时(秒)" i18n-en:displayName="Execution Timeout (Seconds)"
                        domain="executionTimeoutSeconds" propId="9" stdDataType="int" stdSqlType="INTEGER"/>

                <column code="DEADLINE_TIMEOUT_MS" name="deadlineTimeoutMs" displayName="截止超时(毫秒)" i18n-en:displayName="Deadline Timeout (Milliseconds)"
                        domain="deadlineTimeoutMs" propId="10" stdDataType="long" stdSqlType="BIGINT"/>

                <column code="BLOCK_STRATEGY" name="blockStrategy" displayName="阻塞策略" i18n-en:displayName="Block Strategy"
                        domain="blockStrategy" propId="11" stdDataType="int" stdSqlType="INTEGER"
                        ext:dict="retry/block-strategy"/>

                <!-- Callback Configuration -->
                <column code="CALLBACK_ENABLED" name="callbackEnabled" displayName="启用回调" i18n-en:displayName="Callback Enabled"
                        domain="callbackEnabled" propId="12" stdDataType="string" stdSqlType="VARCHAR" defaultValue="0"/>

                <column code="CALLBACK_TRIGGER_TYPE" name="callbackTriggerType" displayName="回调触发类型" i18n-en:displayName="Callback Trigger Type"
                        domain="callbackTriggerType" propId="13" stdDataType="int" stdSqlType="INTEGER"
                        ext:dict="retry/callback-trigger-type"/>

                <column code="CALLBACK_MAX_ATTEMPTS" name="callbackMaxAttempts" displayName="回调最大次数" i18n-en:displayName="Callback Max Attempts"
                        domain="callbackMaxAttempts" propId="14" stdDataType="int" stdSqlType="INTEGER"/>

                <column code="CALLBACK_INTERVAL_SECONDS" name="callbackIntervalSeconds" displayName="回调间隔(秒)" i18n-en:displayName="Callback Interval (Seconds)"
                        domain="callbackIntervalSeconds" propId="15" stdDataType="int" stdSqlType="INTEGER"/>

                <!-- Owner and Description -->
                <column code="OWNER_ID" name="ownerId" displayName="所有者ID" i18n-en:displayName="Owner ID"
                        precision="50" propId="16" stdDataType="string" stdSqlType="VARCHAR"/>

                <column code="DESCRIPTION" name="description" displayName="描述" i18n-en:displayName="Description"
                        precision="4000" propId="17" stdDataType="string" stdSqlType="VARCHAR"/>

                <!-- Audit Fields -->
                <column code="VERSION" name="version" displayName="版本" i18n-en:displayName="Version"
                        domain="version" propId="18" stdDataType="int" stdSqlType="INTEGER"/>

                <column code="CREATED_BY" name="createdBy" displayName="创建人" i18n-en:displayName="Created By"
                        domain="createdBy" propId="19" stdDataType="string" stdSqlType="VARCHAR"/>

                <column code="CREATE_TIME" name="createTime" displayName="创建时间" i18n-en:displayName="Create Time"
                        domain="createTime" propId="20" stdDataType="timestamp" stdSqlType="TIMESTAMP" tagSet="clock"/>

                <column code="UPDATED_BY" name="updatedBy" displayName="更新人" i18n-en:displayName="Updated By"
                        domain="updatedBy" propId="21" stdDataType="string" stdSqlType="VARCHAR"/>

                <column code="UPDATE_TIME" name="updateTime" displayName="更新时间" i18n-en:displayName="Update Time"
                        domain="updateTime" propId="22" stdDataType="timestamp" stdSqlType="TIMESTAMP" tagSet="clock"/>
            </columns>
            <relations>
                <to-many displayName="重试记录" name="records" refEntityName="io.nop.retry.dao.entity.NopRetryRecord"
                         refPropName="template" tagSet="pub,cascade-delete,insertable,updatable"
                         i18n-en:displayName="Retry Records">
                    <join>
                        <on leftProp="sid" rightProp="templateId"/>
                    </join>
                </to-many>
            </relations>
        </entity>
        <entity name="io.nop.retry.dao.entity.NopRetryRecord"
                tableName="nop_retry_record" displayName="重试记录" i18n-en:displayName="Retry Record"
                registerShortName="true" versionProp="version" createTimeProp="createTime"
                createrProp="createdBy" updateTimeProp="updateTime" updaterProp="updatedBy">
            <columns>
                <!-- Primary Key -->
                <column code="SID" name="sid" displayName="主键" i18n-en:displayName="Primary Key"
                        domain="templateId" mandatory="true" primary="true" propId="1"
                        stdDataType="string" stdSqlType="VARCHAR" tagSet="seq"/>

                <!-- Namespace and Group -->
                <column code="NAMESPACE_ID" name="namespaceId" displayName="命名空间ID" i18n-en:displayName="Namespace ID"
                        domain="namespaceId" mandatory="true" propId="2" stdDataType="string" stdSqlType="VARCHAR"/>

                <column code="GROUP_ID" name="groupId" displayName="组ID" i18n-en:displayName="Group ID"
                        domain="groupId" mandatory="true" propId="3" stdDataType="string" stdSqlType="VARCHAR"/>

                <!-- Template Reference -->
                <column code="TEMPLATE_ID" name="templateId" displayName="模板ID" i18n-en:displayName="Template ID"
                        domain="templateId" propId="4" stdDataType="string" stdSqlType="VARCHAR"/>

                <!-- Idempotency -->
                <column code="IDEMPOTENT_ID" name="idempotentId" displayName="幂等ID" i18n-en:displayName="Idempotent ID"
                        domain="idempotentId" mandatory="true" propId="5" stdDataType="string" stdSqlType="VARCHAR"/>

                <!-- Business Identifier -->
                <column code="BIZ_NO" name="bizNo" displayName="业务号" i18n-en:displayName="Business Number"
                        domain="bizNo" propId="6" stdDataType="string" stdSqlType="VARCHAR"/>

                <!-- Task Info -->
                <column code="TASK_TYPE" name="taskType" displayName="任务类型" i18n-en:displayName="Task Type"
                        domain="taskType" propId="7" stdDataType="int" stdSqlType="INTEGER"
                        ext:dict="retry/retry-task-type"/>

                <column code="STATUS" name="status" displayName="状态" i18n-en:displayName="Status"
                        domain="retryRecordStatus" propId="8" stdDataType="int" stdSqlType="INTEGER"
                        ext:dict="retry/retry-record-status"/>

                <!-- Retry Counters -->
                <column code="RETRY_COUNT" name="retryCount" displayName="重试次数" i18n-en:displayName="Retry Count"
                        domain="retryCount" propId="9" stdDataType="int" stdSqlType="INTEGER"/>

                <column code="MAX_RETRY_COUNT" name="maxRetryCount" displayName="最大重试次数" i18n-en:displayName="Max Retry Count"
                        domain="maxRetryCount" propId="10" stdDataType="int" stdSqlType="INTEGER"/>

                <!-- Scheduling -->
                <column code="NEXT_TRIGGER_TIME" name="nextTriggerTime" displayName="下次触发时间" i18n-en:displayName="Next Trigger Time"
                        domain="nextTriggerTime" propId="11" stdDataType="timestamp" stdSqlType="TIMESTAMP"/>

                <column code="PARTITION_INDEX" name="partitionIndex" displayName="分区索引" i18n-en:displayName="Partition Index"
                        domain="partitionIndex" propId="12" stdDataType="int" stdSqlType="INTEGER"/>

                <!-- Execution -->
                <column code="EXECUTOR_NAME" name="executorName" displayName="执行器名称" i18n-en:displayName="Executor Name"
                        domain="executorName" propId="13" stdDataType="string" stdSqlType="VARCHAR"/>

                <column code="SERIALIZER_NAME" name="serializerName" displayName="序列化器名称" i18n-en:displayName="Serializer Name"
                        precision="32" propId="14" stdDataType="string" stdSqlType="VARCHAR"/>

                <!-- Payloads -->
                <column code="REQUEST_PAYLOAD" name="requestPayload" displayName="请求参数" i18n-en:displayName="Request Payload"
                        domain="json-4000" propId="15" stdDataType="string" stdDomain="json" stdSqlType="VARCHAR"/>

                <column code="CONTEXT_PAYLOAD" name="contextPayload" displayName="上下文参数" i18n-en:displayName="Context Payload"
                        domain="json-4000" propId="16" stdDataType="string" stdDomain="json" stdSqlType="VARCHAR"/>

                <!-- Audit Fields -->
                <column code="VERSION" name="version" displayName="版本" i18n-en:displayName="Version"
                        domain="version" propId="17" stdDataType="int" stdSqlType="INTEGER"/>

                <column code="CREATED_BY" name="createdBy" displayName="创建人" i18n-en:displayName="Created By"
                        domain="createdBy" propId="18" stdDataType="string" stdSqlType="VARCHAR"/>

                <column code="CREATE_TIME" name="createTime" displayName="创建时间" i18n-en:displayName="Create Time"
                        domain="createTime" propId="19" stdDataType="timestamp" stdSqlType="TIMESTAMP" tagSet="clock"/>

                <column code="UPDATED_BY" name="updatedBy" displayName="更新人" i18n-en:displayName="Updated By"
                        domain="updatedBy" propId="20" stdDataType="string" stdSqlType="VARCHAR"/>

                <column code="UPDATE_TIME" name="updateTime" displayName="更新时间" i18n-en:displayName="Update Time"
                        domain="updateTime" propId="21" stdDataType="timestamp" stdSqlType="TIMESTAMP" tagSet="clock"/>
            </columns>
            <indexes>
                <!-- Index for scheduler scans -->
                <index name="IDX_RETRY_SCHEDULER_SCAN" unique="false">
                    <column name="status"/>
                    <column name="partitionIndex"/>
                    <column name="nextTriggerTime"/>
                </index>
                <!-- Index for idempotency lookup -->
                <index name="UK_RETRY_IDEMPOTENT_ID" unique="true">
                    <column name="idempotentId"/>
                </index>
                <!-- Index for management queries -->
                <index name="IDX_RETRY_MGMT_LOOKUP" unique="false">
                    <column name="namespaceId"/>
                    <column name="groupId"/>
                    <column name="templateId"/>
                </index>
            </indexes>
            <relations>
                <to-one displayName="模板" name="template" refEntityName="io.nop.retry.dao.entity.NopRetryTemplate"
                        refPropName="records" tagSet="pub,ref-pub"
                        i18n-en:displayName="Template">
                    <join>
                        <on leftProp="templateId" rightProp="sid"/>
                    </join>
                </to-one>
                <to-many displayName="重试尝试" name="attempts" refEntityName="io.nop.retry.dao.entity.NopRetryAttempt"
                         refPropName="record" tagSet="pub,cascade-delete,insertable,updatable"
                         i18n-en:displayName="Retry Attempts">
                    <join>
                        <on leftProp="sid" rightProp="recordId"/>
                    </join>
                </to-many>
            </relations>
        </entity>
        <entity name="io.nop.retry.dao.entity.NopRetryAttempt"
                tableName="nop_retry_attempt" displayName="重试尝试" i18n-en:displayName="Retry Attempt"
                registerShortName="true" versionProp="version" createTimeProp="createTime"
                createrProp="createdBy" updateTimeProp="updateTime" updaterProp="updatedBy">
            <columns>
                <!-- Primary Key -->
                <column code="SID" name="sid" displayName="主键" i18n-en:displayName="Primary Key"
                        domain="templateId" mandatory="true" primary="true" propId="1"
                        stdDataType="string" stdSqlType="VARCHAR" tagSet="seq"/>

                <!-- Foreign Key to NopRetryRecord -->
                <column code="RECORD_ID" name="recordId" displayName="记录ID" i18n-en:displayName="Record ID"
                        domain="templateId" mandatory="true" propId="2" stdDataType="string" stdSqlType="VARCHAR"/>

                <!-- Attempt Info -->
                <column code="ATTEMPT_NO" name="attemptNo" displayName="尝试序号" i18n-en:displayName="Attempt Number"
                        domain="attemptNo" propId="3" stdDataType="int" stdSqlType="INTEGER"/>

                <column code="STATUS" name="status" displayName="状态" i18n-en:displayName="Status"
                        domain="retryAttemptStatus" propId="4" stdDataType="int" stdSqlType="INTEGER"
                        ext:dict="retry/retry-attempt-status"/>

                <!-- Timing -->
                <column code="START_TIME" name="startTime" displayName="开始时间" i18n-en:displayName="Start Time"
                        domain="createTime" propId="5" stdDataType="timestamp" stdSqlType="TIMESTAMP" tagSet="clock"/>

                <column code="END_TIME" name="endTime" displayName="结束时间" i18n-en:displayName="End Time"
                        domain="updateTime" propId="6" stdDataType="timestamp" stdSqlType="TIMESTAMP" tagSet="clock"/>

                <column code="DURATION_MS" name="durationMs" displayName="持续时间(毫秒)" i18n-en:displayName="Duration (Milliseconds)"
                        domain="durationMs" propId="7" stdDataType="long" stdSqlType="BIGINT"/>

                <!-- Error Information -->
                <column code="ERROR_CODE" name="errorCode" displayName="错误码" i18n-en:displayName="Error Code"
                        precision="50" propId="8" stdDataType="string" stdSqlType="VARCHAR"/>

                <column code="ERROR_MESSAGE" name="errorMessage" displayName="错误消息" i18n-en:displayName="Error Message"
                        precision="500" propId="9" stdDataType="string" stdSqlType="VARCHAR"/>

                <column code="ERROR_STACK" name="errorStack" displayName="错误堆栈" i18n-en:displayName="Error Stack"
                        precision="4000" propId="10" stdDataType="string" stdSqlType="VARCHAR"/>

                <!-- Context -->
                <column code="CLIENT_ADDRESS" name="clientAddress" displayName="客户端地址" i18n-en:displayName="Client Address"
                        precision="100" propId="11" stdDataType="string" stdSqlType="VARCHAR"/>

                <column code="REASON" name="reason" displayName="原因" i18n-en:displayName="Reason"
                        precision="500" propId="12" stdDataType="string" stdSqlType="VARCHAR"/>

                <!-- Payload Snapshot -->
                <column code="REQUEST_PAYLOAD_SNAPSHOT" name="requestPayloadSnapshot" displayName="请求参数快照" i18n-en:displayName="Request Payload Snapshot"
                        domain="json-4000" propId="13" stdDataType="string" stdDomain="json" stdSqlType="VARCHAR"/>

                <!-- Audit Fields -->
                <column code="VERSION" name="version" displayName="版本" i18n-en:displayName="Version"
                        domain="version" propId="14" stdDataType="int" stdSqlType="INTEGER"/>

                <column code="CREATED_BY" name="createdBy" displayName="创建人" i18n-en:displayName="Created By"
                        domain="createdBy" propId="15" stdDataType="string" stdSqlType="VARCHAR"/>

                <column code="CREATE_TIME" name="createTime" displayName="创建时间" i18n-en:displayName="Create Time"
                        domain="createTime" propId="16" stdDataType="timestamp" stdSqlType="TIMESTAMP" tagSet="clock"/>

                <column code="UPDATED_BY" name="updatedBy" displayName="更新人" i18n-en:displayName="Updated By"
                        domain="updatedBy" propId="17" stdDataType="string" stdSqlType="VARCHAR"/>

                <column code="UPDATE_TIME" name="updateTime" displayName="更新时间" i18n-en:displayName="Update Time"
                        domain="updateTime" propId="18" stdDataType="timestamp" stdSqlType="TIMESTAMP" tagSet="clock"/>
            </columns>
            <indexes>
                <!-- Index for retrieving attempts for a record -->
                <index name="IDX_RETRY_ATTEMPT_RECORD" unique="false">
                    <column name="recordId"/>
                </index>
                <!-- Index for filtering attempts by status -->
                <index name="IDX_RETRY_ATTEMPT_STATUS" unique="false">
                    <column name="status"/>
                </index>
                <!-- Unique constraint on (recordId, attemptNo) combination -->
                <index name="UK_RETRY_ATTEMPT_RECORD_NO" unique="true">
                    <column name="recordId"/>
                    <column name="attemptNo"/>
                </index>
            </indexes>
            <relations>
                <to-one displayName="记录" name="record" refEntityName="io.nop.retry.dao.entity.NopRetryRecord"
                        refPropName="attempts" tagSet="pub,ref-pub"
                        i18n-en:displayName="Record">
                    <join>
                        <on leftProp="recordId" rightProp="sid"/>
                    </join>
                </to-one>
            </relations>
        </entity>
        <entity name="io.nop.retry.dao.entity.NopRetryDeadLetter"
                tableName="nop_retry_dead_letter" displayName="重试死信" i18n-en:displayName="Retry Dead Letter"
                registerShortName="true" versionProp="version" createTimeProp="createTime"
                createrProp="createdBy" updateTimeProp="updateTime" updaterProp="updatedBy">
            <columns>
                <!-- Primary Key -->
                <column code="SID" name="sid" displayName="主键" i18n-en:displayName="Primary Key"
                        domain="templateId" mandatory="true" primary="true" propId="1"
                        stdDataType="string" stdSqlType="VARCHAR" tagSet="seq"/>

                <!-- Namespace and Group -->
                <column code="NAMESPACE_ID" name="namespaceId" displayName="命名空间ID" i18n-en:displayName="Namespace ID"
                        domain="namespaceId" mandatory="true" propId="2" stdDataType="string" stdSqlType="VARCHAR"/>

                <column code="GROUP_ID" name="groupId" displayName="组ID" i18n-en:displayName="Group ID"
                        domain="groupId" mandatory="true" propId="3" stdDataType="string" stdSqlType="VARCHAR"/>

                <!-- Template Reference -->
                <column code="TEMPLATE_ID" name="templateId" displayName="模板ID" i18n-en:displayName="Template ID"
                        domain="templateId" propId="4" stdDataType="string" stdSqlType="VARCHAR"/>

                <!-- Record Reference (FK to NopRetryRecord) -->
                <column code="RECORD_ID" name="recordId" displayName="记录ID" i18n-en:displayName="Record ID"
                        domain="templateId" mandatory="true" propId="5" stdDataType="string" stdSqlType="VARCHAR"/>

                <!-- Idempotency -->
                <column code="IDEMPOTENT_ID" name="idempotentId" displayName="幂等ID" i18n-en:displayName="Idempotent ID"
                        domain="idempotentId" mandatory="true" propId="6" stdDataType="string" stdSqlType="VARCHAR"/>

                <!-- Business Identifier -->
                <column code="BIZ_NO" name="bizNo" displayName="业务号" i18n-en:displayName="Business Number"
                        domain="bizNo" propId="7" stdDataType="string" stdSqlType="VARCHAR"/>

                <!-- Execution -->
                <column code="EXECUTOR_NAME" name="executorName" displayName="执行器名称" i18n-en:displayName="Executor Name"
                        domain="executorName" propId="8" stdDataType="string" stdSqlType="VARCHAR"/>

                <column code="SERIALIZER_NAME" name="serializerName" displayName="序列化器名称" i18n-en:displayName="Serializer Name"
                        precision="32" propId="9" stdDataType="string" stdSqlType="VARCHAR"/>

                <!-- Payload -->
                <column code="REQUEST_PAYLOAD" name="requestPayload" displayName="请求参数" i18n-en:displayName="Request Payload"
                        domain="json-4000" propId="10" stdDataType="string" stdDomain="json" stdSqlType="VARCHAR"/>

                <!-- Failure Information -->
                <column code="FAILURE_CODE" name="failureCode" displayName="失败码" i18n-en:displayName="Failure Code"
                        precision="50" propId="11" stdDataType="string" stdSqlType="VARCHAR"/>

                <column code="FAILURE_MESSAGE" name="failureMessage" displayName="失败消息" i18n-en:displayName="Failure Message"
                        precision="500" propId="12" stdDataType="string" stdSqlType="VARCHAR"/>

                <column code="ERROR_STACK" name="errorStack" displayName="错误堆栈" i18n-en:displayName="Error Stack"
                        precision="4000" propId="13" stdDataType="string" stdSqlType="VARCHAR"/>

                <!-- Final Status -->
                <column code="FINAL_STATUS" name="finalStatus" displayName="最终状态" i18n-en:displayName="Final Status"
                        domain="retryRecordStatus" propId="14" stdDataType="int" stdSqlType="INTEGER"
                        ext:dict="retry/retry-record-status"/>

                <!-- Audit Fields -->
                <column code="VERSION" name="version" displayName="版本" i18n-en:displayName="Version"
                        domain="version" propId="15" stdDataType="int" stdSqlType="INTEGER"/>

                <column code="CREATED_BY" name="createdBy" displayName="创建人" i18n-en:displayName="Created By"
                        domain="createdBy" propId="16" stdDataType="string" stdSqlType="VARCHAR"/>

                <column code="CREATE_TIME" name="createTime" displayName="创建时间" i18n-en:displayName="Create Time"
                        domain="createTime" propId="17" stdDataType="timestamp" stdSqlType="TIMESTAMP" tagSet="clock"/>

                <column code="UPDATED_BY" name="updatedBy" displayName="更新人" i18n-en:displayName="Updated By"
                        domain="updatedBy" propId="18" stdDataType="string" stdSqlType="VARCHAR"/>

                <column code="UPDATE_TIME" name="updateTime" displayName="更新时间" i18n-en:displayName="Update Time"
                        domain="updateTime" propId="19" stdDataType="timestamp" stdSqlType="TIMESTAMP" tagSet="clock"/>
            </columns>
            <indexes>
                <!-- Index for traceability back to retry record -->
                <index name="IDX_RETRY_DL_RECORD" unique="false">
                    <column name="recordId"/>
                </index>
                <!-- Index for idempotency lookup -->
                <index name="UK_RETRY_DL_IDEMPOTENT_ID" unique="true">
                    <column name="idempotentId"/>
                </index>
                <!-- Index for management queries -->
                <index name="IDX_RETRY_DL_MGMT_LOOKUP" unique="false">
                    <column name="namespaceId"/>
                    <column name="groupId"/>
                    <column name="templateId"/>
                </index>
            </indexes>
            <relations>
                <to-one displayName="记录" name="record" refEntityName="io.nop.retry.dao.entity.NopRetryRecord"
                        refPropName="deadLetter" tagSet="pub,ref-pub"
                        i18n-en:displayName="Record">
                    <join>
                        <on leftProp="recordId" rightProp="sid"/>
                    </join>
                </to-one>
            </relations>
        </entity>
    </entities>
</orm>
