# Log Configuration

## Log Format

In Quarkus, the log format `%d{yyyy-MM-dd HH:mm:ss,SSS} %h %N[%i] %-5p [%c{3.}] (%t) %s%e%n` means:

- %d{yyyy-MM-dd HH:mm:ss,SSS} : Date and time format, for example "2022-01-01 12:34:56,789", where SSS denotes milliseconds.
- %h : Hostname.
- `%N[%i]` : Thread name and thread ID.
- %-5p : Log level, left-aligned and occupying at most 5 characters in width.
- `[%c{3.}]` : Class name, displaying at most 3 characters.
- (%t) : Thread context.
- %s : Log message.
- %e : Exception information.
- %n : Newline.

This log format means each log entry will include the date, time, hostname, thread name and ID, log level, class name, thread context, log message, and exception information, and ends with a newline.

## Configuration Example

```yaml

quarkus:
  log:
    level: INFO

    category:
      "io.nop":
        level: DEBUG

    file:
      enable: true
      path: log/app-demo.log
      #      # Output format
      #      format: %d{yyyy-MM-dd HH:mm:ss,SSS} %h %N[%i] %-5p [%c{3.}] (%t) %s%e%n
      #      # Indicates whether to log asynchronously
      async: true
      rotation:
        max-file-size: 100M
        max-backup-index: 300
        file-suffix: .yyyy-MM-dd

```

To enable TRACE-level logging, you must also configure quarkus.log.min-level=TRACE; otherwise, at most DEBUG-level logs will be emitted.

## Packaging in Submodules

For beans using Quarkus IoC annotations, when packaging them into a JAR, you must include the Jandex plugin to record detailed bean information in the Jandex index file. Otherwise, Quarkus will only scan files in the current project and will not be able to use beans from the JAR.

```
 <plugin>
    <groupId>org.jboss.jandex</groupId>
    <artifactId>jandex-maven-plugin</artifactId>
    <version>1.2.3</version>
    <executions>
        <execution>
            <id>make-index</id>
            <goals>
                <goal>jandex</goal>
            </goals>
        </execution>
    </executions>
</plugin>
```

## Native Compilation

Requires Maven version 3.9.3 or later

```
mvnw install -Dnative -DskipTests -Dquarkus.native.container-build=true
```

- On Windows, the Chinese VC toolchain has issues; configure -H:-CheckToolchain to skip the check.
- Classes such as Font in the AWT module cannot be used.
- Do not include the --report-unsupported-elements-at-runtime option; otherwise, classes excluded via the Delete annotation will still report errors.
- GraalVM 23.1 cannot perform native compilation with Quarkus 3.3.3; you must upgrade to 3.4.1.

## Upload Parsing

You need to add the com.sun.mail dependency, disable the angus-mail module that comes from transitive dependencies, and you must not exclude jaxb-provider.

```xml
        <dependency>
            <groupId>io.quarkus</groupId>
            <artifactId>quarkus-resteasy-multipart</artifactId>
            <exclusions>
                <exclusion>
                    <artifactId>angus-mail</artifactId>
                    <groupId>org.eclipse.angus</groupId>
                </exclusion>
            </exclusions>
        </dependency>

        <dependency>
            <groupId>com.sun.mail</groupId>
            <artifactId>jakarta.mail</artifactId>
        </dependency>
```

## Backend Only with the Nop Platform

If you need to use the NopGraphQL service, you can include the nop-quarkus-web-starter module.

```xml

<pom>
    <!--  Setting parent to nop-entropy integrates default Maven plugins and default dependency management configuration -->
    <parent>
        <artifactId>nop-entropy</artifactId>
        <groupId>io.github.entropy-cloud</groupId>
        <version>2.0.0-SNAPSHOT</version>
    </parent>

    <dependencies>
        <!-- Bring in Nop platform dependencies. Because the parent is set to nop-entropy, you don't need to specify explicit version numbers here -->
        <dependency>
            <groupId>io.github.entropy-cloud</groupId>
            <artifactId>nop-quarkus-web-orm-starter</artifactId>
        </dependency>

        <!-- User and authorization management; this is an optional dependency -->
        <dependency>
            <groupId>io.github.entropy-cloud</groupId>
            <artifactId>nop-auth-service</artifactId>
        </dependency>

        <!-- Optional dependency: dictionary tables, encoding rule table, extended field table, global sequence table, etc. -->
        <dependency>
            <groupId>io.github.entropy-cloud</groupId>
            <artifactId>nop-sys-service</artifactId>
        </dependency>

        <!-- Depend on xxx-web modules only if you need to use AMIS pages generated by the Nop platform -->
        <dependency>
            <groupId>io.github.entropy-cloud</groupId>
            <artifactId>nop-auth-web</artifactId>
        </dependency>

        <dependency>
            <groupId>io.github.entropy-cloud</groupId>
            <artifactId>nop-sys-web</artifactId>
        </dependency>

        <!-- This contains JS and CSS packaged by the nop-chaos project. It provides the frontend menu framework including login pages, etc. If you implement the frontend yourself, you can omit this module -->
        <dependency>
            <groupId>io.github.entropy-cloud</groupId>
            <artifactId>nop-web-site</artifactId>
        </dependency>

    </dependencies>
</pom>
```

## Using Only the NopReport Reporting Engine

```xml

<dependencies>
    <dependency>
        <groupId>io.github.entropy-cloud</groupId>
        <artifactId>nop-quarkus-core-starter</artifactId>
    </dependency>

    <dependency>
        <groupId>io.github.entropy-cloud</groupId>
        <artifactId>nop-report-core</artifactId>
    </dependency>
</dependencies>
```

## Troubleshooting

### 1. Quarkus-defined beans not found
If Quarkus bean definitions are packaged into a library module, that module must configure the `jandex-maven-plugin`.

### 2. Frontend request returns 400 BadRequest
URLs must not include special characters; they must be UTF-8 encoded. For example, `http://localhost:8080/r/NopAuthUser__findPage?@selection=items{id}` will fail.
You must use the following encoding:
```
http://localhost:8080/r/NopAuthSite__findPage?%40selection=items%7Bid%7D
```

### 3. How to set configuration for dev and prod environments
Quarkus distinguishes environments via the `quarkus.profile` setting. In `application.yaml`, set `quarkus.profile: dev` or `quarkus.profile: prod` to select the environment.

### 4. Failed to start in IDEA with no output
An invalid application.yaml format can cause this issue. Add a breakpoint in the main function to debug and trace it.
<!-- SOURCE_MD5:d405b9f7b73e8bc0f59d1577245172d7-->
